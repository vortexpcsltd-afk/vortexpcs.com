import{e as v,l as h,au as b,av as N}from"./index-C09NoPC0.js";import{r as S,u as T,g as _}from"./firebase-D5dyMTPx.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=v("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=v("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=v("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);function g(t){try{if(t!==null&&typeof t=="object"&&"toDate"in t&&typeof t.toDate=="function"){const e=t.toDate();return e instanceof Date&&!isNaN(e.getTime())?e:void 0}if(t instanceof Date)return isNaN(t.getTime())?void 0:t;if(typeof t=="string"||typeof t=="number"){const e=new Date(t);return isNaN(e.getTime())?void 0:e}}catch{}}function B(t){const e=t.orderId||t.orderNumber||t.id||"UNKNOWN",d=t.paymentMethod||"card";let r=typeof t.total=="number"?t.total:0;const i=Array.isArray(t.items)?t.items.map(n=>{const l=typeof n.price=="number"?n.price:0,A=typeof n.quantity=="number"?n.quantity:1,f=n,E=n.productName||f.name||f.description||n.productId||"Item",R=typeof f.category=="string"?f.category:void 0;return!n.productName&&E==="Item"&&h.warn("normalizeOrder: item missing productName",{displayId:e,itemFields:Object.keys(n),item:n}),{name:E,unitPrice:l,quantity:A,lineTotal:l*A,category:R}}):[];r===0&&i.length>0&&(r=i.reduce((n,l)=>n+l.lineTotal,0));const p=Array.isArray(t.buildUpdates)?t.buildUpdates.map(n=>({note:n.note,progress:typeof n.progress=="number"?n.progress:void 0,timestamp:g(n.timestamp)})):[],s=["pending","pending_payment","building","testing","shipped","delivered","completed"].includes(t.status)?t.status:(h.warn("normalizeOrder: unknown status coerced to pending",{received:t.status,displayId:e}),"pending"),o=t,m=g(o.orderDate)||g(o.createdAt),y=g(o.updatedAt),u=g(o.estimatedCompletion),k=g(o.deliveryDate),D=typeof o.trackingNumber=="string"?o.trackingNumber:void 0,z=typeof o.courier=="string"?o.courier:void 0,c=o.address||o.shippingAddress,M=typeof o.notes=="string"?o.notes:void 0,I=typeof o.shippingMethod=="string"?o.shippingMethod:void 0,w=typeof o.shippingCost=="number"?o.shippingCost:void 0,O=c&&typeof c=="object"?{line1:c.line1,line2:c.line2,city:c.city,postcode:c.postcode,country:c.country}:void 0;return{id:String(t.id||e),displayId:String(e),total:r,status:s,paymentMethod:d,items:i,orderDate:m,createdAt:m,updatedAt:y,progress:typeof t.progress=="number"?t.progress:void 0,buildUpdates:p,estimatedCompletion:u,deliveryDate:k,trackingNumber:D,courier:z,address:O,notes:M,shippingMethod:I,shippingCost:w,original:t}}function j(t){return t.map(e=>B(e))}const P=async(t,e,d)=>{var a;if(!b||!((a=N.options)!=null&&a.storageBucket))throw new Error("File storage is not configured (missing storage bucket). Set VITE_FIREBASE_STORAGE_BUCKET to enable uploads.");const r=e.name.replace(/[^\w.-]+/g,"-"),i=`support_tickets/${t}/${Date.now()}-${r}`,p=S(b,i);try{const s=T(p,e,{contentType:e.type||"application/octet-stream"});await new Promise((m,y)=>{s.on("state_changed",u=>{if(d){const k=u.bytesTransferred/u.totalBytes*100;d(k,s)}},u=>y(u),()=>m())});const o=await _(s.snapshot.ref);return{name:e.name,url:o,size:e.size,type:e.type,path:i,scanStatus:"pending"}}catch(s){throw h.error("Attachment upload failed",s),new Error(s instanceof Error?s.message:"Failed to upload attachment")}},C=async(t,e)=>{var p;if(!b||!((p=N.options)!=null&&p.storageBucket))throw new Error("File storage is not configured (missing storage bucket). Set VITE_FIREBASE_STORAGE_BUCKET to enable uploads.");const d=t.name.replace(/[^\w.-]+/g,"-"),r=`email_assets/${Date.now()}-${d}`,i=S(b,r);try{const a=T(i,t,{contentType:t.type||"application/octet-stream"});await new Promise((o,m)=>{a.on("state_changed",y=>{},y=>m(y),()=>o())});const s=await _(a.snapshot.ref);return{name:t.name,url:s,size:t.size,type:t.type,path:r}}catch(a){throw h.error("Email asset upload failed",a),new Error(a instanceof Error?a.message:"Failed to upload email asset")}},V=Object.freeze(Object.defineProperty({__proto__:null,uploadEmailAsset:C,uploadTicketAttachment:P},Symbol.toStringTag,{value:"Module"}));export{q as P,$ as S,x as a,B as b,C as c,j as n,V as s,P as u};
