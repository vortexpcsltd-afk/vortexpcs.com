const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C09NoPC0.js","assets/three-DYdjUtCm.js","assets/contentful-6-L6ww-u.js","assets/firebase-D5dyMTPx.js","assets/index-BtsQyA5c.css"])))=>i.map(i=>d[i]);
import{r as p,j as e,_ as K}from"./three-DYdjUtCm.js";import{u as rt,a as st,P as at,E as nt}from"./react-stripe.esm-C-xIBnmr.js";import{e as he,s as ne,t as Oe,v as ie,B as $e,r as oe,bl as G,l as n,bm as ae,u as it,q as S,bn as ot,C as X,a8 as ct,L as O,I as E,K as me,h as Ae,o as lt,A as dt,as as ut,bo as mt,ar as ht,bp as xt,aA as pt,G as _e}from"./index-C09NoPC0.js";import{B as Ee}from"./LoadingComponents-Czn3_UF5.js";import"./contentful-6-L6ww-u.js";import"./firebase-D5dyMTPx.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=he("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=he("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=he("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);function gt({onSuccess:r,amount:s}){const c=rt(),i=st(),[m,d]=p.useState(!1),[N,k]=p.useState(null),b=async _=>{if(_.preventDefault(),!c||!i){k("Stripe hasn't loaded yet. Please wait a moment.");return}d(!0),k(null);try{const{error:$,paymentIntent:F}=await c.confirmPayment({elements:i,confirmParams:{return_url:`${window.location.origin}/order-success`},redirect:"if_required"});$?(n.error("Stripe payment error:",$),k($.message||"An error occurred while processing your payment."),d(!1)):F&&F.status==="succeeded"?(n.info("Payment succeeded",{paymentIntentId:F.id}),r(F.id)):(n.info("Payment status",{status:F==null?void 0:F.status}),k("Payment is being processed. You will be redirected shortly."))}catch($){n.error("Payment processing error:",$),k("An unexpected error occurred. Please try again."),d(!1)}},C={layout:"tabs",paymentMethodOrder:["card","klarna","revolut_pay"]};return e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-white/5 backdrop-blur-xl border border-white/10 rounded-lg",children:e.jsx(at,{options:C})}),N&&e.jsxs(ne,{className:"bg-red-500/10 border-red-500/30 text-red-400",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx(ie,{children:N})]}),e.jsx($e,{type:"submit",disabled:!c||m,className:"w-full h-14 text-lg bg-gradient-to-r from-sky-600 to-blue-600 hover:from-sky-500 hover:to-blue-500 text-white shadow-lg shadow-sky-500/30 hover:shadow-sky-500/50 transition-all duration-300",children:m?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-5 h-5 mr-2 animate-spin"}),"Processing Payment..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),"Pay £",s.toFixed(2)]})}),e.jsxs("div",{className:"text-center text-sm text-gray-400",children:[e.jsx(G,{className:"w-4 h-4 inline mr-1"}),"Your payment information is encrypted and secure"]})]})}const De="vortex_idempotency_keys",bt=100,wt=1440*60*1e3;function Re(){try{const r=localStorage.getItem(De);if(!r)return[];const s=JSON.parse(r);if(!Array.isArray(s))return[];const c=Date.now();return s.filter(i=>i&&i.timestamp&&c-i.timestamp<wt)}catch(r){return n.warn("Failed to load idempotency keys",{error:r}),[]}}function Te(r){try{const s=r.sort((c,i)=>i.timestamp-c.timestamp).slice(0,bt);localStorage.setItem(De,JSON.stringify(s))}catch(s){n.warn("Failed to save idempotency keys",{error:s})}}function vt(r,s,c){const i=Re(),m=i.find(_=>_.amount===r&&_.currency===s&&_.resultStatus!=="failed");if(m&&m.resultStatus==="success")return n.info("Using cached idempotency key for successful payment"),m.key;const d=Date.now(),N=Math.random().toString(36).substring(2,10),k=c?`-${c.substring(0,20)}`:"",b=`${d}-${N}${k}`,C={key:b,amount:r,currency:s,timestamp:d};return i.push(C),Te(i),n.info("Generated new idempotency key",{key:b}),b}function jt(r,s,c="success"){try{const i=Re(),m=i.findIndex(d=>d.key===r);m!==-1&&(i[m].resultId=s,i[m].resultStatus=c,Te(i),n.info("Recorded idempotency result",{key:r,resultId:s,status:c}))}catch(i){n.warn("Failed to record idempotency result",{error:i})}}function Nt({showOnlyOffline:r=!0,className:s=""}){const[c,i]=p.useState(typeof navigator<"u"?navigator.onLine:!0),[m,d]=p.useState(0),[N,k]=p.useState("");return p.useEffect(()=>ae.subscribe(C=>{i(C),C&&k("")}),[]),p.useEffect(()=>{const b=ae.getQueuedPayments();d(b.length)},[]),p.useEffect(()=>{if(!c){const b=setInterval(()=>{const C=ae.getOfflineDurationString();k(C)},1e3);return()=>clearInterval(b)}},[c]),p.useEffect(()=>{const b=C=>{const _=C;d(_.detail.queue.length),n.info("Payment queue retry event received",_.detail)};return window.addEventListener("vortex:offline-queue-retry",b),()=>{window.removeEventListener("vortex:offline-queue-retry",b)}},[]),r&&c?null:c?e.jsx(ne,{className:`bg-green-500/10 border-green-500/30 ${s}`,children:e.jsxs(ie,{className:"text-green-400 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Connected"]})}):e.jsx(ne,{className:`bg-red-500/20 border-red-500/40 ${s}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Me,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(ie,{className:"text-red-300 font-medium",children:"No Internet Connection"}),e.jsxs("div",{className:"text-sm text-red-300/70 mt-1 space-y-1",children:[e.jsxs("p",{children:["Offline for ",N]}),m>0&&e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-3 h-3 animate-spin"}),m," payment",m!==1?"s":""," waiting to retry"]}),e.jsx("p",{className:"text-xs",children:"Your changes will be saved automatically when reconnected."})]})]})]})})}const ce={free:{id:"free",name:"Free Shipping",estimate:"5–7 working days",cost:0},standard:{id:"standard",name:"Standard",estimate:"2–4 working days",cost:9.99},express:{id:"express",name:"Express",estimate:"1–2 working days",cost:14.99}};function qe(r){return typeof r!="string"?null:ce[r]||null}function Le(r){return typeof r!="string"?!1:r in ce}function kt(r,s){const c=qe(r);return c?typeof s=="number"&&Math.abs(c.cost-s)<.01:!1}function St(r){const s=qe(r);return(s==null?void 0:s.cost)??null}function Pt(){return Object.values(ce)}function Ct(r){if(!Le(r.method))return{valid:!1,error:`Invalid shipping method: ${r.method}. Must be one of: ${Object.keys(ce).join(", ")}`};if(!kt(r.method,r.cost)){const s=St(r.method);return{valid:!1,error:`Shipping cost mismatch. Expected £${s==null?void 0:s.toFixed(2)} for ${r.method}, got £${typeof r.cost=="number"?r.cost.toFixed(2):"invalid"}`}}return{valid:!0}}function Be(r){if(!r||typeof r!="object")return!1;const s=r;return typeof s.id=="string"&&typeof s.name=="string"&&typeof s.price=="number"&&s.price>=0&&Number.isFinite(s.price)}function At(r){if(!r||typeof r!="object")return!1;const s=r;return typeof s.code=="string"&&s.code.trim().length>0&&typeof s.discountPercent=="number"&&s.discountPercent>=0&&s.discountPercent<=100&&typeof s.discountAmount=="number"&&s.discountAmount>=0&&Number.isFinite(s.discountAmount)}function _t(r,s,c){const i=r*s/100;return Math.abs(i-c)>.01?{valid:!1,error:`Discount amount mismatch. Expected £${i.toFixed(2)} (${s}% of £${r.toFixed(2)}), got £${c.toFixed(2)}`}:{valid:!0}}function Et(r){const{subtotal:s,buildServiceCost:c,discountAmount:i,shippingCost:m,total:d}=r;if(!Number.isFinite(s)||s<0)return{valid:!1,error:"Invalid subtotal"};if(!Number.isFinite(c)||c<0)return{valid:!1,error:"Invalid build service cost"};if(!Number.isFinite(i)||i<0)return{valid:!1,error:"Invalid discount amount"};if(!Number.isFinite(m)||m<0)return{valid:!1,error:"Invalid shipping cost"};if(!Number.isFinite(d)||d<0)return{valid:!1,error:"Invalid total"};const N=s+c-i+m;return Math.abs(N-d)>.01?{valid:!1,error:`Order total mismatch. Expected £${N.toFixed(2)}, got £${d.toFixed(2)}`}:i>s?{valid:!1,error:`Discount (£${i.toFixed(2)}) exceeds subtotal (£${s.toFixed(2)})`}:{valid:!0}}function Ft(r){return r?Be(r)?{id:r.id,name:r.name,price:Math.round(r.price*100)/100}:(n.error("Invalid build service data",{service:r}),null):null}function It(r){return r?At(r)?{code:r.code.trim().toUpperCase(),discountPercent:Math.min(100,Math.max(0,r.discountPercent)),discountAmount:Math.round(r.discountAmount*100)/100}:(n.error("Invalid coupon data",{coupon:r}),null):null}function Ot(r,s,c){return{timestamp:Date.now(),subtotal:r.subtotal,buildServiceCost:r.buildServiceCost,discountAmount:r.discountAmount,shippingCost:r.shippingCost,total:r.total,buildServiceId:s,couponCode:c}}function $t(r){const s={length:r.length>=8,uppercase:/[A-Z]/.test(r),lowercase:/[a-z]/.test(r),number:/\d/.test(r),specialChar:/[!@#$%^&*(),.?":{}|<>_\-+=[\]\\/'`~]/.test(r)},c=Object.values(s).filter(Boolean).length;let i;c<=2?i="weak":c<=4?i="medium":i="strong";const m=s.length&&s.uppercase&&s.lowercase&&s.number;let d;return m||(s.length?s.uppercase?s.lowercase?s.number||(d="Password must contain at least one number"):d="Password must contain at least one lowercase letter":d="Password must contain at least one uppercase letter":d="Password must be at least 8 characters long"),m&&!s.specialChar&&n.info("Password valid but lacks special character for extra security"),{valid:m,error:d,strength:i,requirements:s}}async function Mt(r){try{const{auth:s}=await K(async()=>{const{auth:d}=await import("./index-C09NoPC0.js").then(N=>N.cq);return{auth:d}},__vite__mapDeps([0,1,2,3,4]));if(!s)return n.warn("Firebase not initialized, skipping account existence check"),{exists:!1,email:r};const{fetchSignInMethodsForEmail:c}=await K(async()=>{const{fetchSignInMethodsForEmail:d}=await import("./firebase-D5dyMTPx.js").then(N=>N.A);return{fetchSignInMethodsForEmail:d}},[]),i=await c(s,r),m=i.length>0;return m&&n.info("Account already exists for email",{email:r.substring(0,3)+"***",methods:i}),{exists:m,email:r,signInMethods:i}}catch(s){return n.error("Failed to check account existence",{error:s}),{exists:!1,email:r}}}function Dt(r){const s=r.trim();if(!s)return{valid:!1,error:"Email is required"};if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return{valid:!1,error:"Invalid email format"};if(s.length>254)return{valid:!1,error:"Email is too long"};const[i,m]=s.split("@");return i.length>64?{valid:!1,error:"Email local part is too long"}:[".con",".cmo",".co.k",".couk"].some(N=>m.endsWith(N))?{valid:!1,error:"Possible typo in email domain. Did you mean .com or .co.uk?"}:{valid:!0}}function Rt(r,s,c){return{email:r.trim().toLowerCase(),password:s,displayName:c.trim()||r.trim().split("@")[0],timestamp:Date.now()}}function Tt(r){try{const s=btoa(JSON.stringify(r));sessionStorage.setItem("vortex_pending_account",s),n.info("Account creation data stored for post-payment processing")}catch(s){n.error("Failed to store account creation data",{error:s})}}function qt(){try{const r=sessionStorage.getItem("vortex_pending_account");if(!r)return null;const s=JSON.parse(atob(r));sessionStorage.removeItem("vortex_pending_account");const c=Date.now()-3600*1e3;return s.timestamp<c?(n.warn("Account creation data expired, discarding"),null):s}catch(r){return n.error("Failed to retrieve account creation data",{error:r}),null}}function Lt(){try{sessionStorage.removeItem("vortex_pending_account")}catch(r){n.error("Failed to clear account creation data",{error:r})}}async function Bt(r,s,c){const i=[],m=Dt(r);if(!m.valid)return{valid:!1,error:m.error};const d=$t(s);return d.valid?(d.strength==="weak"&&i.push("Password is weak. Consider adding special characters."),(await Mt(r)).exists?{valid:!1,error:"An account with this email already exists. Please log in instead.",accountExists:!0}:(c.trim()||i.push("Display name is empty, will use email username"),{valid:!0,warnings:i.length>0?i:void 0,accountExists:!1})):{valid:!1,error:d.error}}const Ut=["vortex_shipping_address","vortex_pending_account","checkout_error","latest_payment_intent","latest_order_number","bank_order_id","vortex_cart"],Yt=["vortex_pending_account","checkout_error"],Ue={fullName:"",email:"",phone:"",line1:"",line2:"",city:"",county:"",postcode:"",country:"United Kingdom",password:""};function Kt(){try{Ut.forEach(r=>{try{localStorage.removeItem(r)}catch(s){n.warn(`Failed to remove localStorage key: ${r}`,{err:s})}}),n.info("Checkout storage cleared")}catch(r){n.error("Failed to clear checkout storage",{error:r})}}function Vt(){try{Yt.forEach(r=>{try{sessionStorage.removeItem(r)}catch(s){n.warn(`Failed to remove sessionStorage key: ${r}`,{err:s})}}),n.info("Checkout session storage cleared")}catch(r){n.error("Failed to clear checkout session storage",{error:r})}}function Fe(){Kt(),Vt(),n.info("Complete checkout cleanup performed")}function Jt(){try{sessionStorage.removeItem("vortex_pending_account"),localStorage.removeItem("checkout_error"),sessionStorage.removeItem("checkout_error"),n.info("Sensitive checkout data cleared")}catch(r){n.error("Failed to clear sensitive checkout data",{error:r})}}function Ie(){return n.info("Resetting form after successful checkout"),{...Ue}}const zt=mt("");function er({cartItems:r,cartHydrated:s,onBack:c,onSuccess:i}){const m=it(),[d,N]=p.useState("stripe"),[k,b]=p.useState(!1),[C,_]=p.useState(null),[$,F]=p.useState(0),[q,Ye]=p.useState(null),[V,Ke]=p.useState(""),[H,Ve]=p.useState(typeof navigator<"u"?navigator.onLine:!0);p.useEffect(()=>ae.subscribe(a=>{Ve(a),a||S.warning("No internet connection. Payments are temporarily unavailable.")}),[]),p.useEffect(()=>{const t=qt();t&&(n.info("Found pending account creation, attempting retry"),(async()=>{try{const{registerUser:a}=await K(async()=>{const{registerUser:l}=await import("./index-C09NoPC0.js").then(u=>u.cs);return{registerUser:l}},__vite__mapDeps([0,1,2,3,4]));await a(t.email,t.password,t.displayName),n.info("Pending account created successfully",{email:t.email}),S.success("Your account has been created!")}catch(a){n.error("Pending account creation retry failed",{err:a}),S.error("Unable to create your account. Please contact support or register manually.")}})())},[]),p.useEffect(()=>{s&&(!r||r.length===0)&&(n.warn("Checkout accessed with empty cart, redirecting"),S.error("Your cart is empty"),setTimeout(()=>m("/"),100))},[s,r,m]),p.useEffect(()=>()=>{Jt(),n.info("CheckoutPage unmounted, sensitive data cleared")},[]);const[o,ee]=p.useState({...Ue}),[v,te]=p.useState({}),[re,se]=p.useState(""),[y,B]=p.useState(null),[xe,J]=p.useState(null),[pe,fe]=p.useState(!1),ye=[{id:"standard-assembly",name:"Standard Assembly",price:85,positioning:"Straightforward, reliable, cost-effective.",campaign:"Built right, ready to run.",includes:["Professional assembly of all selected components","Cable management (functional, not showcase)","BIOS update and system check","Windows installation (if purchased)","14-day build warranty"],idealFor:"Customers who want their parts put together correctly and ready to go.",badge:"Great value",accent:"from-slate-800/80 via-sky-800/50 to-sky-900/40"},{id:"performance-build",name:"Performance Build",price:130,positioning:"Elevated service with polish and optimisation.",campaign:"Optimised, polished, battle-ready.",includes:["All Standard Assembly features","Advanced cable management with airflow optimisation","Stress testing (CPU, GPU, RAM) for stability","Thermal paste upgrade (premium compound)","RGB lighting setup and sync","1-month build support"],idealFor:"Gamers and creators who want assurance their system is tuned and looks sharp.",badge:"Most popular",accent:"from-sky-800/70 via-blue-800/60 to-blue-900/50"},{id:"elite-showcase",name:"Elite Showcase Build",price:185,positioning:"VIP build, priority and attention to detail",campaign:"Showcase perfection, benchmarked brilliance.",includes:["All Performance Build features","Custom cable sleeving and aesthetic routing","BIOS/firmware fine-tuning for performance","Full benchmark report (FPS, temps, scores)","Priority support for 6 months","Extended build warranty (1 year)"],idealFor:"Enthusiasts who want their PC to be a centerpiece — technically and visually.",badge:"Fastest turnaround",accent:"from-blue-900/70 via-indigo-900/60 to-cyan-900/50"}],[ge,be]=p.useState("performance-build"),[Z,Je]=p.useState(!0),[z,ze]=p.useState(!0),U=p.useMemo(()=>{const t=new Set;for(const a of r){const l=(a.category||"").toString().toLowerCase();l&&t.add(l)}return t},[r]),we=p.useMemo(()=>r.reduce((t,a)=>t+(a.quantity||0),0),[r]),ve=p.useMemo(()=>{const t=U.has("cpu"),a=U.has("motherboard"),l=U.has("ram"),u=U.has("storage"),h=U.has("psu"),w=U.has("case"),P=t&&a&&l&&u,g=h&&w,A=we>=5;return P&&g&&A},[U,we]),je=Pt(),[Q,We]=p.useState("free"),Y=r.reduce((t,a)=>typeof a.price!="number"||typeof a.quantity!="number"||a.price<0||a.quantity<1?(n.warn("Invalid cart item in total calculation",{item:a}),t):t+a.price*a.quantity,0),I=je.find(t=>t.id===Q).cost,f=ve&&Z?ye.find(t=>t.id===ge):null,le=(f==null?void 0:f.price)??0,de=Y+le,Ge=(y==null?void 0:y.discountAmount)??0,Ne=de-Ge,L=Ne+I;p.useEffect(()=>{try{const t=localStorage.getItem("vortex_shipping_address");if(t){const a=JSON.parse(t);typeof a=="object"&&a!==null?(delete a.password,a.email&&a.postcode?ee(l=>({...l,...a})):(n.warn("Saved address missing essential fields, ignoring"),localStorage.removeItem("vortex_shipping_address"))):(n.warn("Saved address is not a valid object, ignoring"),localStorage.removeItem("vortex_shipping_address"))}}catch(t){n.warn("Failed to load saved address",{error:t});try{localStorage.removeItem("vortex_shipping_address")}catch{}}},[]);const ke=async t=>{if(!t.trim()){J(null),B(null);return}fe(!0),J(null);try{const a=await fetch("/api/coupons/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t.trim().toUpperCase()})});if(!a.ok){const h=await a.json();J(h.message||"Invalid coupon code"),B(null);return}const l=await a.json(),u=de*l.discountPercent/100;B({code:t.trim().toUpperCase(),discountPercent:l.discountPercent,discountAmount:u}),J(null)}catch(a){n.error("Coupon validation error:",a),J("Unable to validate coupon. Please try again."),B(null)}finally{fe(!1)}},M=(t,a)=>{_(t);try{sessionStorage.setItem("checkout_error",JSON.stringify({message:t,type:a,timestamp:Date.now()}))}catch(l){n.error("Failed to persist error state",l)}S.error(t)},Se=()=>{_(null);try{sessionStorage.removeItem("checkout_error")}catch(t){n.error("Failed to clear error state",t)}},He=async()=>{var a,l,u,h,w,P;const t={};if((a=o.fullName)!=null&&a.trim()?o.fullName.trim().length<2&&(t.fullName="Full name must be at least 2 characters"):t.fullName="Full name is required",(l=o.email)!=null&&l.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email.trim())||(t.email="Invalid email address"):t.email="Email is required",(u=o.phone)!=null&&u.trim()?/^[+]?[(]?[0-9]{1,4}[)]?[-\s.]?[(]?[0-9]{1,4}[)]?[-\s.]?[0-9]{1,9}$/.test(o.phone.trim())||(t.phone="Invalid phone number"):t.phone="Phone number is required",(h=o.line1)!=null&&h.trim()?o.line1.trim().length<5&&(t.line1="Street address must be at least 5 characters"):t.line1="Street address is required",(w=o.city)!=null&&w.trim()?o.city.trim().length<2&&(t.city="City must be at least 2 characters"):t.city="City is required",(P=o.postcode)!=null&&P.trim()?/^[A-Z]{1,2}\d[A-Z\d]? ?\d[A-Z]{2}$/i.test(o.postcode.trim())||(t.postcode="Invalid UK postcode (e.g., SW1A 1AA)"):t.postcode="Postcode is required",z){const g=(o.password||"").trim(),A=o.email.trim(),W=o.fullName.trim();if(g?g.length<8?t.password="Password must be at least 8 characters":/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(g)||(t.password="Password must contain uppercase, lowercase, and numbers"):t.password="Password is required to create an account",A&&g&&!t.email&&!t.password)try{const j=await Bt(A,g,W);j.valid?j.warnings&&j.warnings.forEach(x=>{S.warning(x)}):j.accountExists?t.email=j.error||"Account already exists":t.password=j.error||"Invalid password"}catch(j){n.warn("Account validation check failed, continuing",{err:j})}}return te(t),Object.keys(t).length===0},D=(t,a)=>{ee(l=>({...l,[t]:a})),v[t]&&te(l=>{const u={...l};return delete u[t],u})},Pe=async()=>{var t;if(Se(),!H){M("No internet connection. Please check your network and try again.","network"),S.error("Offline: Payment temporarily unavailable");return}if(!await He()){M("Please fill in all required fields correctly","validation");return}try{localStorage.setItem("vortex_shipping_address",JSON.stringify(o))}catch(a){n.warn("Failed to save address",{error:a})}b(!0);try{let a=null;try{const{auth:x}=await K(async()=>{const{auth:R}=await import("./index-C09NoPC0.js").then(T=>T.cq);return{auth:R}},__vite__mapDeps([0,1,2,3,4]));if(x!=null&&x.currentUser){const{getIdToken:R}=await K(async()=>{const{getIdToken:T}=await import("./firebase-D5dyMTPx.js").then(tt=>tt.A);return{getIdToken:T}},[]);a=await R(x.currentUser)}}catch{}const l=r.filter(x=>!x||!x.id||!x.name||typeof x.price!="number"||x.price<0||typeof x.quantity!="number"||x.quantity<1||!x.category);if(l.length>0){M("Some items in your cart are invalid. Please refresh and try again.","validation"),b(!1),n.error("Invalid cart items detected",{invalidItems:l});return}if(r.length===0&&!f){M("Your cart is empty","validation"),b(!1);return}const u=Ct({method:Q,cost:I});if(!u.valid){M(u.error||"Invalid shipping method or cost","validation"),b(!1),n.error("Shipping validation failed",{method:Q,cost:I,error:u.error});return}if(y){const x=_t(Y,y.discountPercent,y.discountAmount);if(!x.valid){M(x.error||"Discount calculation mismatch. Please try again.","validation"),b(!1),n.error("Coupon validation failed",{coupon:y,subtotal:Y,error:x.error});return}}if(f&&!Be(f)){M("Invalid build service selected","validation"),b(!1),n.error("Build service validation failed",{buildService:f});return}const h=Et({subtotal:Y,buildServiceCost:(f==null?void 0:f.price)??0,discountAmount:(y==null?void 0:y.discountAmount)??0,shippingCost:I,total:L});if(!h.valid){M(h.error||"Order pricing validation failed","validation"),b(!1),n.error("Order pricing validation failed",{subtotal:Y,buildServiceCost:f==null?void 0:f.price,discountAmount:y==null?void 0:y.discountAmount,shippingCost:I,total:L,error:h.error});return}const w=f?{id:`build-service-${f.id}`,name:f.name,category:"build-service",price:f.price,quantity:1}:null,P=[...r.map(x=>({id:x.id,name:x.name,category:x.category,price:Math.max(0,x.price),quantity:Math.max(1,Math.floor(x.quantity)),image:x.image})),...w?[w]:[]],g=It(y??null),A=Ft(f??null),W=Ot({subtotal:Y,buildServiceCost:(f==null?void 0:f.price)??0,discountAmount:(y==null?void 0:y.discountAmount)??0,shippingCost:I,total:L},f==null?void 0:f.id,y==null?void 0:y.code),j={amount:L,currency:"gbp",cartItems:P,shippingAddress:{street:o.line1,line2:o.line2,city:o.city,state:o.county,postcode:o.postcode,country:o.country},customerEmail:o.email,customerName:o.fullName,customerPhone:o.phone,shippingMethod:Q,shippingCost:I,coupon:g,buildService:A,pricingAudit:W,accountRequest:z?{create:!0,fullName:o.fullName,email:o.email,phone:o.phone,password:(t=o.password)==null?void 0:t.trim(),address:{line1:o.line1,line2:o.line2,city:o.city,county:o.county,postcode:o.postcode,country:o.country}}:{create:!1}};switch(d){case"stripe":await Ce(j,a);break;case"paypal":await Qe(j,a);break;case"bank_transfer":await Xe(j,a);break;default:throw new Error("Invalid payment method")}}catch(a){n.error("Checkout error:",a),_(a instanceof Error?a.message:"Payment processing failed. Please try again."),S.error("Payment processing failed"),b(!1)}},ue=async()=>{if(!z)return;const t=(o.password||"").trim();if(!t)return;const a=Rt(o.email,t,o.fullName);try{const{registerUser:l}=await K(async()=>{const{registerUser:u}=await import("./index-C09NoPC0.js").then(h=>h.cs);return{registerUser:u}},__vite__mapDeps([0,1,2,3,4]));await l(a.email,a.password,a.displayName),n.info("Account created from checkout",{email:a.email}),Lt(),S.success("Account created successfully!")}catch(l){const u=l instanceof Error?l.message:String(l);if(u.includes("already exists")||u.includes("email-already-in-use")){n.warn("Account already exists, skipping creation",{email:a.email}),S.info("Account already exists with this email. Please log in to view your order.");return}n.error("Account creation failed, storing for retry",{error:u}),Tt(a),S.error("Account creation failed. Your order was successful, but please contact support to activate your account.",{duration:6e3})}},Ce=async(t,a)=>{var l;try{let u;try{const{auth:j}=await K(async()=>{const{auth:x}=await import("./index-C09NoPC0.js").then(R=>R.cq);return{auth:x}},__vite__mapDeps([0,1,2,3,4]));u=(l=j==null?void 0:j.currentUser)==null?void 0:l.uid}catch{}const h=t.amount,w=t.currency||"gbp",P=vt(h,w,u),g=await fetch("/api/stripe/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json","Idempotency-Key":P,...a&&{Authorization:`Bearer ${a}`}},body:JSON.stringify(t)});if(!g.ok){const j=await g.text();let x="Failed to initialize payment",R={};try{const T=JSON.parse(j);R=T,T.message&&(x=T.message),g.status===403?x="CSRF validation failed":g.status===500&&T.error&&(x=`Server error: ${T.error}`)}catch{R={rawError:j}}throw n.error("Payment Intent creation failed",{status:g.status,statusText:g.statusText,error:x,details:R,orderAmount:t.amount}),new Error(`${x} (Status: ${g.status})`)}const{clientSecret:A,orderNumber:W}=await g.json();if(!A)throw n.error("Missing clientSecret in response",{response:await g.json()}),new Error("No client secret returned from server");g.ok&&jt(P,A,"success"),Ye(A),Ke(W),b(!1),Se(),F(0),n.info("Payment Intent created",{orderNumber:W}),S.success("Ready to process payment")}catch(u){n.error("Stripe payment error",u);let h="Failed to initialize payment. Please try again.",w="server";u instanceof Error&&(h=u.message,h.includes("CSRF")||h.includes("Status: 403")||h.includes("validation failed")?(w="validation",h="Security validation failed. Please refresh the page and try again."):h.includes("fetch")||h.includes("network")||h.includes("offline")||h.includes("Failed to fetch")?(w="network",h="Network error. Please check your connection and try again."):(h.includes("amount")||h.includes("invalid")||h.includes("cart")||h.includes("mismatch"))&&(w="payment")),M(h,w),b(!1),w==="network"&&$<2&&(F($+1),S.info(`Retrying... (Attempt ${$+1}/2)`),setTimeout(()=>{Ce(t,a)},2e3))}},Ze=async t=>{n.info("Stripe payment successful",{paymentIntentId:t,orderNumber:V}),await ue();try{localStorage.setItem("latest_payment_intent",t),V&&localStorage.setItem("latest_order_number",V)}catch{}S.success("Payment successful! Your order is confirmed."),i(t,V),ee(Ie()),te({}),se(""),B(null),Fe();const a=new URLSearchParams({pi:t});V&&a.set("order",V),m(`/order-success?${a.toString()}`)},Qe=async(t,a)=>{var P;const l={items:t.cartItems,customerEmail:t.customerEmail,currency:t.currency,metadata:{shippingAddress:t.shippingAddress,customerName:t.customerName,customerPhone:t.customerPhone,buildService:f?`${f.name} (£${f.price.toFixed(2)})`:""}},u=await fetch("/api/paypal/create-order",{method:"POST",headers:{"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`}},body:JSON.stringify(l)});if(!u.ok){const g=await u.text();n.error("PayPal order creation failed",{status:u.status,error:g});try{const A=JSON.parse(g);throw new Error(A.error||A.message||"Failed to create PayPal order")}catch{throw new Error(`Failed to create PayPal order: ${u.status}`)}}const w=(P=(await u.json()).links)==null?void 0:P.find(g=>g.rel==="approve");if(!(w!=null&&w.href))throw new Error("PayPal approval URL not found");await ue(),window.location.href=w.href},Xe=async(t,a)=>{const l=await fetch("/api/orders/bank-transfer",{method:"POST",headers:{"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`}},body:JSON.stringify(t)});if(!l.ok){const w=await l.text();n.error("Bank transfer order creation failed",{status:l.status,error:w});try{const P=JSON.parse(w);throw new Error(P.error||P.message||"Failed to create bank transfer order")}catch{throw new Error(`Failed to create bank transfer order: ${l.status}`)}}const{orderId:u,orderNumber:h}=await l.json();await ue(),localStorage.setItem("latest_order_number",h),localStorage.setItem("bank_order_id",u),S.success("Order created! Check your email for bank transfer details."),i(u,h),ee(Ie()),te({}),se(""),B(null),Fe(),m(`/order-success?bank=${u}&order=${h}`)},et=[{id:"stripe",name:"Credit/Debit Card",description:"Pay securely with Visa, Mastercard, or Amex",icon:ht,recommended:!0},{id:"paypal",name:"PayPal",description:"Fast and secure PayPal checkout",icon:yt},{id:"bank_transfer",name:"Bank Transfer",description:"Direct bank transfer (manual verification required)",icon:xt}];return s?!r||r.length===0?e.jsx("div",{className:"min-h-screen py-12 px-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(oe,{className:"w-12 h-12 animate-spin mx-auto mb-4 text-sky-500"}),e.jsx("p",{children:"Redirecting..."})]})}):e.jsx("div",{className:"min-h-screen py-12 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs($e,{variant:"ghost",onClick:c,className:"mb-4 text-sky-400 hover:text-sky-300 hover:bg-sky-500/10",children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),"Back to Cart"]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-2",children:"Secure Checkout"}),e.jsx("p",{className:"text-gray-400",children:"Complete your order with secure payment"})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(X,{className:"bg-white/5 backdrop-blur-xl border-white/10 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(ct,{className:"w-5 h-5 mr-2 text-sky-400"}),"Shipping Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"fullName",className:"text-gray-300 mb-2 block",children:"Full Name *"}),e.jsx(E,{id:"fullName",value:o.fullName,onChange:t=>D("fullName",t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),Pe())},className:`bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-sky-500/50 focus:ring-2 focus:ring-sky-500/20 transition-all ${v.fullName?"border-red-500":""}`,placeholder:"John Smith"}),v.fullName&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:v.fullName})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"email",className:"text-gray-300 mb-2 block",children:"Email Address *"}),e.jsx(E,{id:"email",type:"email",value:o.email,onChange:t=>D("email",t.target.value),className:`bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-sky-500/50 focus:ring-2 focus:ring-sky-500/20 transition-all ${v.email?"border-red-500":""}`,placeholder:"john@example.com"}),v.email&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:v.email})]})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"phone",className:"text-gray-300 mb-2 block",children:"Phone Number *"}),e.jsx(E,{id:"phone",value:o.phone,onChange:t=>D("phone",t.target.value),className:`bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-sky-500/50 focus:ring-2 focus:ring-sky-500/20 transition-all ${v.phone?"border-red-500":""}`,placeholder:"07700 900000"}),v.phone&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:v.phone})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"line1",className:"text-gray-300 mb-2 block",children:"Address Line 1 *"}),e.jsx(E,{id:"line1",value:o.line1,onChange:t=>D("line1",t.target.value),className:`bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-sky-500/50 focus:ring-2 focus:ring-sky-500/20 transition-all ${v.line1?"border-red-500":""}`,placeholder:"123 High Street"}),v.line1&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:v.line1})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"line2",className:"text-gray-300 mb-2 block",children:"Address Line 2"}),e.jsx(E,{id:"line2",value:o.line2,onChange:t=>D("line2",t.target.value),className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-sky-500/50 focus:ring-2 focus:ring-sky-500/20 transition-all",placeholder:"Apartment, suite, etc. (optional)"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"city",className:"text-gray-300 mb-2 block",children:"City *"}),e.jsx(E,{id:"city",value:o.city,onChange:t=>D("city",t.target.value),className:`bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-sky-500/50 focus:ring-2 focus:ring-sky-500/20 transition-all ${v.city?"border-red-500":""}`,placeholder:"London"}),v.city&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:v.city})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"county",className:"text-gray-300 mb-2 block",children:"County"}),e.jsx(E,{id:"county",value:o.county,onChange:t=>D("county",t.target.value),className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-sky-500/50 focus:ring-2 focus:ring-sky-500/20 transition-all",placeholder:"Greater London"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"postcode",className:"text-gray-300 mb-2 block",children:"Postcode *"}),e.jsx(E,{id:"postcode",value:o.postcode,onChange:t=>D("postcode",t.target.value.toUpperCase()),className:`bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-sky-500/50 focus:ring-2 focus:ring-sky-500/20 transition-all ${v.postcode?"border-red-500":""}`,placeholder:"SW1A 1AA"}),v.postcode&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:v.postcode})]})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"country",className:"text-gray-300 mb-2 block",children:"Country"}),e.jsx(E,{id:"country",value:o.country,readOnly:!0,className:"bg-white/5 border-white/10 text-gray-400 cursor-not-allowed opacity-60"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[220px]",children:[e.jsxs("p",{className:"text-sm text-white font-medium flex items-center gap-2",children:["Create a free account",e.jsx("span",{className:"text-[11px] bg-sky-500/20 text-sky-200 px-2 py-0.5 rounded-full border border-sky-500/30",children:"Recommended"})]}),e.jsx("p",{className:"text-xs text-gray-400 leading-relaxed mt-1",children:"Save your address for faster checkout, track orders and returns, and get dedicated support."})]}),e.jsx("button",{type:"button",onClick:()=>ze(t=>!t),className:`flex-shrink-0 relative inline-flex h-9 w-16 items-center rounded-full transition-colors ${z?"bg-sky-600":"bg-gray-700"}`,children:e.jsx("span",{className:`inline-block h-7 w-7 transform rounded-full bg-white transition-transform ${z?"translate-x-7":"translate-x-1"}`})})]}),z&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(O,{htmlFor:"password",className:"text-gray-300 mb-2 block",children:"Create Password *"}),e.jsx(E,{id:"password",type:"password",value:o.password,onChange:t=>D("password",t.target.value),className:`bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-sky-500/50 focus:ring-2 focus:ring-sky-500/20 transition-all ${v.password?"border-red-500":""}`,placeholder:"Create a password"}),v.password&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:v.password}),e.jsx("p",{className:"text-[11px] text-gray-400 mt-1",children:"6+ characters. Your email becomes your username."})]})})]})]}),ve&&e.jsxs(X,{className:"bg-white/5 backdrop-blur-xl border-white/10 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-5",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-sky-400"}),"Custom Build Service"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1 max-w-3xl",children:"Choose how far we go with assembly, optimisation, and presentation."})]}),e.jsx("div",{className:"px-3 py-1 rounded-full bg-sky-500/15 border border-sky-500/30 text-xs text-sky-200 whitespace-nowrap",children:"Auto-applied for full builds"})]}),Z&&e.jsx("div",{className:"grid gap-4 md:grid-cols-3 mb-6",children:ye.map(t=>{const a=ge===t.id;return e.jsxs("button",{type:"button",onClick:()=>be(t.id),"aria-pressed":a,disabled:!!q||k,className:`group relative w-full text-left rounded-2xl border transition-all duration-200 p-5 bg-gradient-to-br ${t.accent} ${a?"border-sky-400/70 shadow-lg shadow-sky-500/30":"border-white/10 hover:border-sky-400/40 hover:shadow-sky-500/20"} disabled:opacity-50 disabled:cursor-not-allowed flex flex-col`,children:[e.jsxs("div",{className:"mb-3 w-full",children:[e.jsx("p",{className:"text-white font-semibold text-lg leading-tight mb-1",children:t.name}),e.jsx("p",{className:"text-[13px] text-gray-300 leading-snug",children:t.positioning})]}),e.jsx("div",{className:"text-center mb-3 w-full",children:e.jsxs("p",{className:"text-2xl font-bold text-sky-100",children:["£",t.price.toFixed(0)]})}),t.badge&&e.jsx("span",{className:"w-full text-center text-[11px] px-2 py-1.5 rounded-full bg-white/10 border border-white/20 text-sky-100 mb-3",children:t.badge}),e.jsx("span",{className:"w-full text-center text-[11px] text-sky-200 bg-white/10 border border-white/10 rounded-full px-2 py-1.5 mb-3",children:t.campaign}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-300/80",children:"Includes"}),e.jsx("ul",{className:"space-y-1.5",children:t.includes.map(l=>e.jsxs("li",{className:"text-xs text-white/90 flex items-start gap-2",children:[e.jsx("span",{className:"mt-1 inline-block w-1.5 h-1.5 rounded-full bg-sky-300 flex-shrink-0"}),e.jsx("span",{children:l})]},l))}),e.jsxs("div",{className:"pt-3 border-t border-white/10 mt-3 text-[12px] text-gray-200 leading-snug",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-400 mb-1",children:"Ideal for"}),e.jsx("p",{children:t.idealFor})]})]}),e.jsxs("button",{type:"button",onClick:()=>be(t.id),className:`w-full mt-4 inline-flex items-center justify-center gap-1 text-[12px] px-2 py-2 rounded-lg border transition-all ${a?"border-sky-300/60 text-white bg-sky-500/20":"border-white/30 text-gray-200 hover:border-sky-300/40 hover:bg-sky-500/10"}`,children:[a?e.jsx(Ae,{className:"w-3.5 h-3.5"}):e.jsx(me,{className:"w-3.5 h-3.5"}),a?"Selected":"Select"]})]},t.id)})}),e.jsx("div",{className:"border-t border-white/10 pt-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed",children:"If you prefer to assemble your own PC, toggle below to remove the build service fee. You'll receive all your components unassembled, ready for you to build."})}),e.jsx("button",{onClick:()=>{Je(!Z)},className:`flex-shrink-0 relative inline-flex h-8 w-14 items-center rounded-full transition-colors ${Z?"bg-gray-700":"bg-sky-600"}`,children:e.jsx("span",{className:`inline-block h-6 w-6 transform rounded-full bg-white transition-transform ${Z?"translate-x-1":"translate-x-7"}`})})]})})]}),e.jsx(X,{className:"bg-white/5 backdrop-blur-xl border-white/10 p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white/5 border border-white/10 rounded-lg",children:[e.jsx(lt,{className:"w-5 h-5 text-green-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white font-medium",children:"Secure Payment"}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"256-bit SSL"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white/5 border border-white/10 rounded-lg",children:[e.jsx(dt,{className:"w-5 h-5 text-sky-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white font-medium",children:"3-Year Warranty"}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"Full coverage"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white/5 border border-white/10 rounded-lg",children:[e.jsx(ut,{className:"w-5 h-5 text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white font-medium",children:"Fast Delivery"}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"From 1-2 days"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white/5 border border-white/10 rounded-lg",children:[e.jsx(ft,{className:"w-5 h-5 text-purple-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white font-medium",children:"Easy Returns"}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"30-day policy"})]})]})]})}),e.jsxs(X,{className:"bg-white/5 backdrop-blur-xl border-white/10 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(G,{className:"w-5 h-5 mr-2 text-sky-400"}),"Payment Method"]}),d==="stripe"&&q?e.jsx(nt,{stripe:zt,options:{clientSecret:q,appearance:{theme:"night",variables:{colorPrimary:"#0ea5e9",colorBackground:"#0b1220",colorText:"#ffffff",colorDanger:"#ef4444",fontFamily:"system-ui, sans-serif",borderRadius:"8px"}}},children:e.jsx(gt,{onSuccess:Ze,amount:L})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:et.map(t=>e.jsx("button",{type:"button",onClick:()=>N(t.id),disabled:!!q,className:`w-full text-left p-4 rounded-lg border-2 transition-all ${d===t.id?"border-sky-500 bg-sky-500/10":"border-white/10 bg-white/5 hover:border-white/20"} ${q?"opacity-50 cursor-not-allowed":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(t.icon,{className:`w-6 h-6 ${d===t.id?"text-sky-400":"text-gray-400"}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:t.name}),t.recommended&&e.jsx("span",{className:"text-xs bg-sky-500/20 text-sky-400 px-2 py-0.5 rounded",children:"Recommended"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:t.description})]})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${d===t.id?"border-sky-500 bg-sky-500":"border-gray-400"}`,children:d===t.id&&e.jsx(Ae,{className:"w-4 h-4 text-white"})})]})},t.id))}),!H&&e.jsx(Nt,{showOnlyOffline:!1,className:"mb-4"}),C&&e.jsxs(ne,{className:"bg-red-500/10 border-red-500/30 text-red-400 mt-4",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx(ie,{children:C})]}),!q&&e.jsx(Ee,{onClick:t=>{t.preventDefault(),Pe()},isLoading:k,loadingText:"Processing...",disabled:!H,className:`w-full h-14 text-lg text-white shadow-lg transition-all duration-300 mt-6 ${H?"bg-gradient-to-r from-sky-600 to-blue-600 hover:from-sky-500 hover:to-blue-500 shadow-sky-500/30 hover:shadow-sky-500/50":"bg-gray-600 cursor-not-allowed opacity-50"}`,children:H?d==="stripe"?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),"Continue to Payment - £",L.toFixed(2)]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),"Complete Secure Payment - £",L.toFixed(2)]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-5 h-5 mr-2"}),"Offline - Payment Unavailable"]})}),!q&&e.jsxs("div",{className:"text-center text-sm text-gray-400 mt-4",children:[e.jsx(G,{className:"w-4 h-4 inline mr-1"}),"Your payment information is encrypted and secure"]})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(X,{className:"bg-white/5 backdrop-blur-xl border-white/10 p-6 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[r.map(t=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-white/5 border border-white/10 rounded flex items-center justify-center flex-shrink-0",children:t.image?e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover rounded"}):e.jsx(pt,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Qty: ",t.quantity]}),e.jsxs("p",{className:"text-sm text-sky-400 font-semibold",children:["£",(t.price*t.quantity).toFixed(2)]})]})]},t.id)),f&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-white/5 border border-sky-500/40 rounded flex items-center justify-center flex-shrink-0",children:e.jsx(me,{className:"w-5 h-5 text-sky-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm truncate",children:f.name}),e.jsx("p",{className:"text-xs text-gray-400",children:"Custom Build Service"}),e.jsxs("p",{className:"text-sm text-sky-400 font-semibold",children:["£",le.toFixed(2)]})]})]})]}),e.jsx(_e,{className:"bg-white/10 my-4"}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Components"}),e.jsxs("span",{className:"text-white",children:["£",Y.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Custom Build Service"}),e.jsxs("span",{className:"text-white",children:["£",le.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Subtotal"}),e.jsxs("span",{className:"text-white",children:["£",de.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2 p-3 rounded-md bg-white/5 border border-white/10",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Discount Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{type:"text",placeholder:"Enter coupon code",value:re,onChange:t=>se(t.target.value.toUpperCase()),onBlur:()=>ke(re),disabled:k||pe,className:"h-9 bg-black/30 border-white/20 text-white placeholder:text-gray-500"}),e.jsx(Ee,{type:"button",onClick:()=>ke(re),disabled:!re.trim()||k,isLoading:pe,loadingText:"Applying...",className:"h-9 px-3 bg-sky-600 hover:bg-sky-500 text-white text-sm rounded-md",children:"Apply"})]}),xe&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:xe}),y&&e.jsxs("div",{className:"flex items-center justify-between bg-green-500/10 border border-green-500/30 rounded p-2 mt-2",children:[e.jsxs("span",{className:"text-xs text-green-400",children:[y.code," (",y.discountPercent,"% off)"]}),e.jsx("button",{type:"button",onClick:()=>{se(""),B(null),J(null)},className:"text-green-400 hover:text-green-300 text-xs font-semibold",children:"Remove"})]})]}),y&&y.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-400",children:"Discount"}),e.jsxs("span",{className:"text-green-400 font-semibold",children:["-£",y.discountAmount.toFixed(2)]})]}),y&&y.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Subtotal after discount"}),e.jsxs("span",{className:"text-white",children:["£",Ne.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2 p-3 rounded-md bg-white/5 border border-white/10",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Shipping Method"}),je.map(t=>e.jsxs("button",{type:"button",disabled:k||!!q,onClick:()=>{Le(t.id)?We(t.id):(n.error("Invalid shipping method selected",{method:t.id}),S.error("Invalid shipping method"))},className:`w-full text-left px-3 py-2 rounded-md flex items-center justify-between transition-all duration-200 border ${Q===t.id?"bg-sky-500/20 border-sky-500/40":"bg-black/10 border-white/10 hover:border-sky-500/30"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-white font-medium",children:t.name}),e.jsx("span",{className:"text-xs text-gray-400",children:t.estimate})]}),e.jsx("div",{className:"text-sm font-semibold text-sky-400",children:t.cost===0?"FREE":`£${t.cost.toFixed(2)}`})]},t.id)),e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-gray-500 mb-2",children:"Shipping Partners"}),e.jsxs("div",{className:"flex items-center justify-center gap-3 flex-wrap",children:[e.jsx("div",{className:"px-2 py-1 bg-white/5 rounded text-[10px] text-gray-400",children:"DPD"}),e.jsx("div",{className:"px-2 py-1 bg-white/5 rounded text-[10px] text-gray-400",children:"Royal Mail"}),e.jsx("div",{className:"px-2 py-1 bg-white/5 rounded text-[10px] text-gray-400",children:"DHL"})]}),e.jsx("p",{className:"text-[9px] text-gray-500 text-center mt-1.5",children:"Collections & returns available"})]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Shipping"}),e.jsx("span",{className:I===0?"text-green-400":"text-white",children:I===0?"FREE":`£${I.toFixed(2)}`})]})]}),e.jsx(_e,{className:"bg-white/10 my-4"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg text-white font-semibold",children:"Total"}),e.jsxs("span",{className:"text-2xl text-sky-400 font-bold",children:["£",L.toFixed(2)]})]})]})})]})]})}):e.jsx("div",{className:"min-h-screen py-12 px-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(oe,{className:"w-12 h-12 animate-spin mx-auto mb-4 text-sky-500"}),e.jsx("p",{children:"Loading your cart..."})]})})}export{er as CheckoutPage};
